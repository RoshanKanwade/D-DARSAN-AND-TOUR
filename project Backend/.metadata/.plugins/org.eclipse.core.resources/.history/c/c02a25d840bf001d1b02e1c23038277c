package com.app.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.app.dto.HotelregistrationDetails;
import com.app.dto.RegisteredDto;
import com.app.exceptionhHandling.UsernameNotFoundException;
import com.app.pojos.RegistrationDetail;
import com.app.pojos.User;
import com.app.service.RegisterService;
@RestController
@CrossOrigin(origins = "*")
public class RegisterController {
	@Autowired
	private RegisterService register;

	@Autowired
	JavaMailSender javaMailSender;
	@PostMapping(path = "/home/register", consumes = "application/x-www-form-urlencoded")
	public String Register( RegisteredDto dto) throws UsernameNotFoundException {
	RegistrationDetail existingUser = register.findByMobileNo(dto);
        if (existingUser != null) {
         return "allrady registerd ";
        }
        SimpleMailMessage sm = new SimpleMailMessage();
		sm.setFrom("team.dineeazy@gmail.com");//input the sender email Id or read it from properties file
		sm.setTo(booking.getCustomer().getEmailId());
		sm.setSubject("DineEazy_Booking cancelled Successfully Booking Id : "+ booking.getBookingId());
		sm.setText("Dear "+booking.getCustomer().getFirstName() +",\n\n"
				+ "\t Your booking has been cancelled successful.Booking amount will be refunded to your respective account within the next 7 working days.\n\n"
				+ "Booking ID         :"+booking.getBookingId()+"\n"
				+ "Restaurant Name : "+booking.getRestInfo1().getRestaurantName()+"\n"
				+ "Guest Name        : "+booking.getGuestName()+"\n"
				+ "Booking Date      : "+booking.getBookingDate()+"\n"
				+ "Time Slot            : "+booking.getTimeslot() +"\n"
				+ "Number Of seats : "+booking.getNumberOfGuest() +"\n"
				+ "Booking Status  : "+booking.getBookingStatus() +"\n"
				+ "Booking Amount  : "+booking.getTableBookingAmount() + "\n\n"
				+ "regards, \n"+ "Team DineEazy");
		javaMailSender.send(sm);
       register.save(dto);
        return "sucssecfull";
	}
	@PostMapping(path = "/home/register/hotel",consumes = "application/x-www-form-urlencoded")
	public String HotelRegister(HotelregistrationDetails dto) {
		System.out.println("fejefff");
		System.out.println(dto);
		RegistrationDetail existingUser = register.findOwnerByMobileNo(dto);
        if (existingUser != null) {
         return "allrady registerd ";
        }
       register.save(dto);
        return "sucssecfull";
	}
}
